;
; M32ASSEM_LedMatrixAcaseStudy.asm
;
; Created: 04/03/2018 19:09:22
; Author : Mahmoud Saad Zerox86
;


; Replace with your application code
.INCLUDE "M32DEF.INC"
.ORG 0X00	
		LDI R16,HIGH(RAMEND)
		OUT SPH,R16
		LDI R16,LOW(RAMEND)
		OUT SPL,R16


		LDI R16,0XFF
		OUT DDRA,R16
		OUT DDRD,R16

		
		
;		B00000000,B01100000,B01110000,B01111000,B01101100,B01100110,B01100011,B01100001
LDI R17,0X00
.DEF COUNTER =R16
.DEF DATA =R17
.DEF LOOPER_1=R18
.DEF LOOPER_2=R19

MAIN :
		LDI R20,1
FRAME_1 :
		CALL OUT_FRAME_1
		DEC R20
		BRNE FRAME_1

		LDI R20,1
FRAME_2 :
		CALL OUT_FRAME_2
		DEC R20
		BRNE FRAME_2

		JMP MAIN

OUT_FRAME_1 :
		LDI COUNTER,8
		LDI LOOPER_1,0X00
		LDI LOOPER_2,0X00
GET_ALL1 :	
		LDI ZH,HIGH(UP1<<1)
		LDI ZL, LOW(UP1<<1)
		ADD ZL,LOOPER_1
		LPM DATA,Z
		OUT PORTA,DATA
		
		LDI ZH,HIGH(DWN<<1)
		LDI ZL,LOW (DWN<<1)
		ADD ZL,LOOPER_2
		LPM DATA,Z
		OUT PORTD,DATA

		INC LOOPER_1
		INC LOOPER_2
		CALL DELAY
		DEC COUNTER
		BRNE GET_ALL1
RET

OUT_FRAME_2 :
		LDI COUNTER,8
		LDI LOOPER_1,0X00
		LDI LOOPER_2,0X00
GET_ALL2 :	
		LDI ZH,HIGH(UP2<<1)
		LDI ZL, LOW(UP2<<1)
		ADD ZL,LOOPER_1
		LPM DATA,Z
		OUT PORTA,DATA
		
		LDI ZH,HIGH(DWN<<1)
		LDI ZL,LOW (DWN<<1)
		ADD ZL,LOOPER_2
		LPM DATA,Z
		OUT PORTD,DATA

		INC LOOPER_1
		INC LOOPER_2
		CALL DELAY
		DEC COUNTER
		BRNE GET_ALL2
RET

		.ORG 0X300
		UP1 : .DB 0b00101000,0b00111000,0b00010000,0b00100000,0b00010000,0b01111100,0b10010010,0b00111000

		.ORG 0X320
		UP2 : .DB 0b00101000,0b00111000,0b00010000,0b00001000,0b10010010,0b01111100,0b00010000,0b00111000
		
		.ORG 0X350
		DWN : .DB 0B01111111,0B10111111,0B11011111,0B11101111,0B11110111,0B11111011,0B11111101,0B11111110


JMP MAIN
;FUNC TO CONVERT DECIMALS TO 7SEG
;FUNC TO TURN THE LIGHT ON FOR 9 SEC.S AND OFF FOR 9 SEC.S


DELAY :	
		LDI R20,10
LOOP_1: LDI R21,10
LOOP_2: 
		NOP
		NOP
		NOP
		NOP
		DEC R21
		BRNE LOOP_2
		DEC R20
		BRNE LOOP_1
RET

//void smile(int time_wanted_in_seconds)
	/*{
		#define DELAY 1500
		time_wanted_in_seconds =(int)(time_wanted_in_seconds/((float)DELAY/((float)1000000)));
		for(;time_wanted_in_seconds >0;time_wanted_in_seconds--)
		{
			UP  = 0b00011000;//////////////
			DWN = 0b01111111;
			_delay_us(DELAY);
			UP  = 0b00100100;///////////////
			DWN = 0b10111111;
			_delay_us(DELAY);
			UP  = 0b01000010;//////////////
			DWN = 0b11011111;
			_delay_us(DELAY);
			UP  = 0b00011000;//////////////
			DWN = 0b11101111;
			_delay_us(DELAY);
			UP  = 0b00011000;//////////////
			DWN = 0b11110111;
			_delay_us(DELAY);
			UP  = 0b00100100;//////////////
			DWN = 0b11111011;
			_delay_us(DELAY);
			UP  = 0b01100110;//////////////
			DWN = 0b11111101;
			_delay_us(DELAY);
			UP  = 0b01100110;//////////////
			DWN = 0b11111110;
			_delay_us(DELAY);
		}
		//return 0;
	}*/
